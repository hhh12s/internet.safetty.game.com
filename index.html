<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>КиберКвест - Полная версия</title>
    <style>
        /* Стили остаются без изменений */
        :root {
            --primary: #2563eb;
            --secondary: #10b981;
            --accent: #f59e0b;
            --background: #f8fafc;
            --text: #1e293b;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            margin: 0;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--primary);
            color: white;
            border-radius: 0 0 2rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .round {
            background: white;
            border-radius: 1.5rem;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .round.hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            height: 0;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .card {
            background: white;
            border: 2px solid var(--primary);
            padding: 1rem;
            border-radius: 0.75rem;
            cursor: grab;
            transition: all 0.2s ease;
            user-select: none;
            text-align: center;
            width: calc(33.333% - 1rem);
        }

        .card:active {
            cursor: grabbing;
            transform: scale(1.02);
        }

        .card-img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .card p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text);
        }

        .drop-zones {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .drop-zone {
            background: #f8fafc;
            border: 2px dashed var(--accent);
            min-height: 150px;
            padding: 1rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease;
            flex: 1;
            text-align: center;
        }

        .drop-zone.active {
            border-color: var(--secondary);
            background: rgba(16, 185, 129, 0.05);
        }

        .drop-zone.correct {
            border-color: var(--secondary);
            background: rgba(16, 185, 129, 0.1);
        }

        .drop-zone.incorrect {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        button {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            font-weight: 500;
            margin-top: 1rem;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            height: 0.5rem;
            background: #e2e8f0;
            border-radius: 0.25rem;
            margin: 2rem 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: var(--secondary);
            width: 0;
            transition: width 0.5s ease;
        }

        .matching-game {
            display: flex;
            gap: 2rem;
        }

        .column {
            flex: 1;
        }

        .rule, .proverb {
            background: white;
            border: 2px solid var(--primary);
            padding: 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 1rem;
        }

        .rule.active, .proverb.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .matched {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .quiz .question {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }

        .quiz .answers {
            margin-bottom: 2rem;
        }

        .quiz .answer {
            background: white;
            border: 2px solid var(--primary);
            padding: 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0.5rem 0;
        }

        .quiz .answer.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--primary);
            border-radius: 0.75rem;
            margin: 1rem 0;
            font-size: 1rem;
        }

        .sentences-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .sentence-group {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .sentence-group h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }

        #passwordRules p {
            color: #666;
            transition: color 0.3s ease;
        }

        #passwordRules p.valid {
            color: #10b981;
            font-weight: bold;
        }

        #passwordRules p.valid::before {
            content: "✔️ ";
        }

        .rebus-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }

        .rebus {
            text-align: center;
        }

        .rebus-img {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .rebus input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--primary);
            border-radius: 0.75rem;
            margin-top: 1rem;
            font-size: 1rem;
        }

        .incorrect input {
            border-color: red;
        }

        /* Новые стили для блока с результатами */
        .results-container {
            background: white;
            border-radius: 1.5rem;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .results-container.hidden {
            display: none;
        }

        .results-container h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .results-container p {
            font-size: 1.1rem;
            margin: 0.5rem 0;
        }

        .results-container .total-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary);
            margin-top: 1.5rem;
        }

        .results-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .result-item {
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            flex: 1 1 calc(33.333% - 1.5rem);
            max-width: 200px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
        }

        .result-item p {
            margin: 0;
            font-size: 1rem;
            color: var(--text);
        }

        .total-score {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header {
                padding: 2rem 1rem;
            }

            .matching-game {
                flex-direction: column;
            }

            .result-item {
                flex: 1 1 calc(50% - 1.5rem);
            }
        }

        @media (max-width: 480px) {
            .result-item {
                flex: 1 1 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🛡️ КиберКвест</h1>
            <p>Интерактивная игра по безопасности в интернете</p>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
        </header>

        <!-- Раунд 1: Безопасные действия -->
        <div class="round" id="round1">
            <h2>🔒 Раунд 1: Можно или нельзя?</h2>
            <h2>Переместите каждое утверждение соответствующую ячейку.</h2>
            <div class="cards-container">
                <div class="card" draggable="true" data-correct="нельзя">
                    <img src="media/image1.jpg" alt="Папа Дим Димыча перевел деньги" class="card-img" draggable="false">
                    <p>Папа Дим Димыча перевел 5 тысяч рублей на неизвестный сайт.</p>
                </div>
                <div class="card" draggable="true" data-correct="нельзя">
                    <img src="media/image2.jpg" alt="Дим Димыч получил сообщение с угрозой" class="card-img" draggable="false">
                    <p>Дим Димыч получил сообщение с угрозой и вымогательством денег.</p>
                </div>
                <div class="card" draggable="true" data-correct="нельзя">
                    <img src="media/image3.jpg" alt="Катя переписывается с незнакомцами" class="card-img" draggable="false">
                    <p>Катя переписывается с подозрительными незнакомцами.</p>
                </div>
                <div class="card" draggable="true" data-correct="нельзя">
                    <img src="media/image4.jpg" alt="Катя добавила незнакомого фиксика в друзья" class="card-img" draggable="false">
                    <p>Катя добавила незнакомого фиксика в друзья.</p>
                </div>
                <div class="card" draggable="true" data-correct="можно">
                    <img src="media/image5.jpg" alt="Профессор пользуется антивирусом" class="card-img" draggable="false">
                    <p>Профессор пользуется лицензионными антивирусными программами.</p>
                </div>
                <div class="card" draggable="true" data-correct="нельзя">
                    <img src="media/image6.jpg" alt="Дим Димыч рассказал пароль" class="card-img" draggable="false">
                    <p>Дим Димыч рассказал свой пароль от компьютера.</p>
                </div>
                <div class="card" draggable="true" data-correct="можно">
                    <img src="media/image7.jpg" alt="Дим Димыч защитил аккаунт паролем" class="card-img" draggable="false">
                    <p>Дим Димыч имеет свой аккаунт, защищенный паролем.</p>
                </div>
                <div class="card" draggable="true" data-correct="нельзя">
                    <img src="media/image8.jpg" alt="Нолик перешел по неизвестной ссылке" class="card-img" draggable="false">
                    <p>Нолик перешел по неизвестной ссылке.</p>
                </div>
                <div class="card" draggable="true" data-correct="нельзя">
                    <img src="media/image9.jpg" alt="Нолик использует одинаковые пароли" class="card-img" draggable="false">
                    <p>Нолик использует одинаковые пароли для всех аккаунтов.</p>
                </div>
                <div class="card" draggable="true" data-correct="можно">
                    <img src="media/image10.jpg" alt="Фиксики пользуются официальными источниками" class="card-img" draggable="false">
                    <p>Фиксики пользуются только официальными источниками.</p>
                </div>
            </div>
            <div class="drop-zones">
                <div class="drop-zone" data-category="можно">✅ Можно</div>
                <div class="drop-zone" data-category="нельзя">❌ Нельзя</div>
            </div>
            <button onclick="checkRound(1)">Проверить</button>
        </div>

        <!-- Раунд 2: Мудрые советы -->
        <div class="round hidden" id="round2">
            <h2>🧩 Раунд 2: Мудрые советы</h2>
            <h2>Найди для каждой пословицы верное утверждение.</h2>
            <div class="matching-game">
                <div class="column" id="proverbs-column">
                    <div class="proverb" data-id="6">Не верь чужим речам, а верь своим очам.</div>
                    <div class="proverb" data-id="5">Береженого Бог бережет.</div>
                    <div class="proverb" data-id="3">Берегись бед пока их нет.</div>
                    <div class="proverb" data-id="1">Осторожность – мать безопасности.</div>
                    <div class="proverb" data-id="4">Опасение – это половина спасения.</div>
                    <div class="proverb" data-id="2">Не всякому верь, запирай крепче дверь.</div>
                </div>
                <div class="column" id="rules-column">
                    <div class="rule" data-id="1">В интернете не стоит переходить по ссылкам, которые кажутся подозрительными.</div>
                    <div class="rule" data-id="2">Для защиты личной информации придумайте надежный пароль и никому его не сообщайте.</div>
                    <div class="rule" data-id="3">Для защиты своего компьютера необходимо регулярное обновление программного обеспечения.</div>
                    <div class="rule" data-id="4">Для безопасности общения в социальных сетях оставляйте как можно меньше данных о себе и избирательно подходите к предложениям о дружбе.</div>
                    <div class="rule" data-id="5">Перед просмотром входящих писем на электронном ящике, проверьте адрес отправителя.</div>
                    <div class="rule" data-id="6">Постарайтесь избегать общения с незнакомцами и ни в коем случае не соглашайтесь с ними на встречу в реальной жизни.</div>
                </div>
            </div>
            <button onclick="checkRound(2)">Проверить</button>
        </div>

        <!-- Раунд 3: КиберВикторина -->
        <div class="round hidden" id="round3">
            <h2>🎯 Раунд 3: КиберВикторина</h2>
            <div class="quiz">
                <!-- Вопросы и ответы будут добавлены динамически -->
            </div>
            <button onclick="checkRound(3)">Ответить</button>
        </div>

        <!-- Раунд 4: Сбор предложений -->
        <div class="round hidden" id="round4">
            <h2>🧩 Раунд 4: Собери определение</h2>
            <div class="sentences-container">
                <div class="sentence-group">
                    <h3>Фишинг</h3>
                    <div class="cards-container" data-sentence="1"></div>
                    <div class="drop-zone" data-sentence="1"></div>
                </div>
                <div class="sentence-group">
                    <h3>Кибербуллинг</h3>
                    <div class="cards-container" data-sentence="2"></div>
                    <div class="drop-zone" data-sentence="2"></div>
                </div>
                <div class="sentence-group">
                    <h3>Пароль</h3>
                    <div class="cards-container" data-sentence="3"></div>
                    <div class="drop-zone" data-sentence="3"></div>
                </div>
                <div class="sentence-group">
                    <h3>Вирус</h3>
                    <div class="cards-container" data-sentence="4"></div>
                    <div class="drop-zone" data-sentence="4"></div>
                </div>
            </div>
            <button onclick="checkRound(4)">Проверить</button>
        </div>

        <!-- Раунд 5: Пароль -->
        <div class="round hidden" id="round5">
            <h2>🔑 Раунд 5: Создание пароля</h2>
            <input type="text" id="passwordInput" placeholder="Придумайте пароль...">
            <div id="passwordRules">
                <p id="rule1">✓ Не менее 8 символов</p>
                <p id="rule2">✓ Цифры и буквы</p>
                <p id="rule3">✓ Специальные символы</p>
            </div>
            <button onclick="checkRound(5)">Проверить</button>
        </div>

        <!-- Раунд 6: Ребусы -->
        <div class="round hidden" id="round6">
            <h2>🕵️ Раунд 6: КиберРебусы</h2>
            <div class="rebus-container">
                <div class="rebus" id="rebus1">
                    <img src="media/image11.png" alt="Ребус: Фишинг" class="rebus-img">
                    <input type="text" placeholder="Ваш ответ..." data-answer="фишинг">
                </div>
                <div class="rebus hidden" id="rebus2">
                    <img src="media/image12.png" alt="Ребус: Логин" class="rebus-img">
                    <input type="text" placeholder="Ваш ответ..." data-answer="логин">
                </div>
                <div class="rebus hidden" id="rebus3">
                    <img src="media/image13.png" alt="Ребус: Спам" class="rebus-img">
                    <input type="text" placeholder="Ваш ответ..." data-answer="спам">
                </div>
                <div class="rebus hidden" id="rebus4">
                    <img src="media/image14.png" alt="Ребус: Пароль" class="rebus-img">
                    <input type="text" placeholder="Ваш ответ..." data-answer="пароль">
                </div>
                <div class="rebus hidden" id="rebus5">
                    <img src="media/image15.png" alt="Ребус: Интернет" class="rebus-img">
                    <input type="text" placeholder="Ваш ответ..." data-answer="интернет">
                </div>
            </div>
            <button onclick="checkRound(6)">Проверить</button>
        </div>

        <!-- Блок с результатами -->
        <div class="results-container hidden" id="results">
            <h2>🎉 Игра завершена!</h2>
            <p class="total-score">Общий результат: <span id="totalScore">0</span> из 35</p>
            <div class="results-grid">
                <div class="result-item">
                    <p>Раунд 1: <span id="round1Result">0</span> из 10</p>
                </div>
                <div class="result-item">
                    <p>Раунд 2: <span id="round2Result">0</span> из 6</p>
                </div>
                <div class="result-item">
                    <p>Раунд 3: <span id="round3Result">0</span> из 7</p>
                </div>
                <div class="result-item">
                    <p>Раунд 4: <span id="round4Result">0</span> из 4</p>
                </div>
                <div class="result-item">
                    <p>Раунд 5: <span id="round5Result">0</span> из 3</p>
                </div>
                <div class="result-item">
                    <p>Раунд 6: <span id="round6Result">0</span> из 5</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentRound = 1;
        const totalRounds = 6;
        let score = 0;
        let matchedPairs = new Map();
        let selectedAnswers = new Map();
        let currentRebus = 1; // Текущий ребус
        const totalRebuses = 5; // Общее количество ребусов

        // Общие функции
        function updateProgress() {
            const progress = (currentRound / totalRounds) * 100;
            document.getElementById('progress').style.width = `${progress}%`;
        }

        // Раунд 1: Drag-and-Drop
        function initRound1() {
            const cards = document.querySelectorAll('#round1 .card');
            const dropZones = document.querySelectorAll('#round1 .drop-zone');

            cards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.correct);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            if (e.target.classList.contains('drop-zone')) {
                e.target.classList.add('active');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            const correct = e.dataTransfer.getData('text/plain');
            const card = document.querySelector('.dragging');
            
            if (e.target.classList.contains('drop-zone')) {
                if (e.target.dataset.category === correct) {
                    // Если карточка перетащена в правильную зону
                    e.target.appendChild(card);
                    e.target.classList.add('correct');
                } else {
                    // Если карточка перетащена в неправильную зону
                    e.target.classList.add('incorrect');
                }
            }
            e.target.classList.remove('active');
        }

        // Раунд 2: Соединение линиями
        let selectedProverb = null;
        let selectedRule = null;

        function initRound2() {
            const proverbs = document.querySelectorAll('.proverb');
            const rules = document.querySelectorAll('.rule');

            proverbs.forEach(proverb => {
                proverb.addEventListener('click', () => handleClick(proverb));
            });

            rules.forEach(rule => {
                rule.addEventListener('click', () => handleClick(rule));
            });
        }

        function handleClick(element) {
            if (element.classList.contains('proverb')) {
                if (selectedProverb) selectedProverb.classList.remove('active');
                selectedProverb = element;
                selectedProverb.classList.add('active');
            } else if (element.classList.contains('rule')) {
                if (selectedRule) selectedRule.classList.remove('active');
                selectedRule = element;
                selectedRule.classList.add('active');
            }

            // Если выбраны и пословица, и правило
            if (selectedProverb && selectedRule) {
                checkPair(selectedProverb, selectedRule);
                selectedProverb.classList.remove('active');
                selectedRule.classList.remove('active');
                selectedProverb = null;
                selectedRule = null;
            }
        }

        function checkPair(proverb, rule) {
            if (proverb.dataset.id === rule.dataset.id) {
                // Подсветка зелёным
                proverb.classList.add('matched');
                rule.classList.add('matched');

                // Исчезновение через 0.5 секунды
                setTimeout(() => {
                    proverb.style.display = 'none';
                    rule.style.display = 'none';
                }, 500);

                // Сохранение пары
                matchedPairs.set(proverb.dataset.id, true);
            }
        }

        // Раунд 3: Викторина
        const questions = [
            {
                question: "1. Что такое фишинг?",
                answers: [
                    { text: "Ловля рыбы", correct: false },
                    { text: "Вид интернет-мошенничества", correct: true },
                    { text: "Компьютерный вирус", correct: false }
                ]
            },
            {
                question: "2. Что такое двухфакторная аутентификация?",
                answers: [
                    { text: "Использование двух паролей", correct: false },
                    { text: "Дополнительный уровень безопасности, например, код из SMS", correct: true },
                    { text: "Два аккаунта на одном сайте", correct: false }
                ]
            },
            {
                question: "3. Какой пароль считается надежным?",
                answers: [
                    { text: "123456", correct: false },
                    { text: "P@ssw0rd!", correct: true },
                    { text: "qwerty", correct: false }
                ]
            },
            {
                question: "4. Что такое VPN?",
                answers: [
                    { text: "Виртуальная игра", correct: false },
                    { text: "Технология для безопасного подключения к интернету", correct: true },
                    { text: "Социальная сеть", correct: false }
                ]
            },
            {
                question: "5. Что такое антивирус?",
                answers: [
                    { text: "Игра для компьютера", correct: false },
                    { text: "Программа для защиты от вредоносного ПО", correct: true },
                    { text: "Социальная сеть", correct: false }
                ]
            },
            {
                question: "6. Что такое кибербуллинг?",
                answers: [
                    { text: "Игра в интернете", correct: false },
                    { text: "Преследование в интернете", correct: true },
                    { text: "Обучение программированию", correct: false }
                ]
            },
            {
                question: "7. Что такое cookie?",
                answers: [
                    { text: "Вид вируса", correct: false },
                    { text: "Небольшие файлы, которые хранят данные о посещении сайтов", correct: true },
                    { text: "Социальная сеть", correct: false }
                ]
            }
        ];

        function initRound3() {
            const quizContainer = document.querySelector('#round3 .quiz');
            questions.forEach((q, index) => {
                // Создаем контейнер для вопроса
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.dataset.id = index + 1;
                questionDiv.textContent = q.question;

                // Создаем контейнер для ответов
                const answersDiv = document.createElement('div');
                answersDiv.className = 'answers';
                answersDiv.dataset.question = index + 1;

                // Перемешиваем ответы
                const shuffledAnswers = shuffleArray(q.answers);

                // Добавляем ответы
                shuffledAnswers.forEach(answer => {
                    const answerDiv = document.createElement('div');
                    answerDiv.className = 'answer';
                    answerDiv.textContent = answer.text;
                    answerDiv.dataset.correct = answer.correct;
                    answerDiv.addEventListener('click', function() {
                        // Снимаем выделение с других ответов на этот вопрос
                        document.querySelectorAll(`.answers[data-question="${index + 1}"] .answer`).forEach(a => {
                            a.classList.remove('selected');
                        });
                        // Выделяем текущий ответ
                        this.classList.add('selected');
                        // Сохраняем выбранный ответ
                        selectedAnswers.set(index + 1, this.dataset.correct === 'true');
                    });
                    answersDiv.appendChild(answerDiv);
                });

                // Добавляем вопрос и ответы в контейнер
                quizContainer.appendChild(questionDiv);
                quizContainer.appendChild(answersDiv);
            });
        }

        // Раунд 4: Сбор предложений
        const sentences = [
            {
                id: 1,
                parts: [
                    "Фишинг – это вид интернет-мошенничества,",
                    "целью которого является получение",
                    "доступа к конфиденциальным данным пользователей –",
                    "логинам и паролям."
                ]
            },
            {
                id: 2,
                parts: [
                    "Кибербуллинг – это преследование сообщениями,",
                    "содержащими оскорбления,",
                    "агрессию, запугивание."
                ]
            },
            {
                id: 3,
                parts: [
                    "Пароль – условное слово или произвольный набор знаков,",
                    "состоящий из букв, цифр и других знаков,",
                    "предназначенный для защиты своего аккаунта."
                ]
            },
            {
                id: 4,
                parts: [
                    "Вирус – это небольшая программа,",
                    "которая распространяется с одного компьютера на другой",
                    "и мешает работе компьютера."
                ]
            }
        ];

        function initRound4() {
            const sentenceGroups = document.querySelectorAll('#round4 .sentence-group');

            sentenceGroups.forEach(group => {
                const sentenceId = group.querySelector('.cards-container').dataset.sentence;
                const sentence = sentences.find(s => s.id == sentenceId);

                // Перемешиваем части предложения
                const shuffledParts = shuffleArray([...sentence.parts]);

                // Добавляем перемешанные части в контейнер
                const cardsContainer = group.querySelector('.cards-container');
                shuffledParts.forEach(part => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.draggable = true;
                    card.textContent = part;
                    cardsContainer.appendChild(card);
                });

                // Инициализация Drag-and-Drop
                const dropZone = group.querySelector('.drop-zone');
                initDragAndDrop(cardsContainer, dropZone);
            });
        }

        function initDragAndDrop(cardsContainer, dropZone) {
            const cards = cardsContainer.querySelectorAll('.card');

            cards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
            });

            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('drop', handleDrop);

            // Добавляем возможность перетаскивания внутри дропзоны
            dropZone.addEventListener('dragover', handleDragOverInsideDropZone);
            dropZone.addEventListener('drop', handleDropInsideDropZone);
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.textContent);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            if (e.target.classList.contains('drop-zone')) {
                e.target.classList.add('active');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            const text = e.dataTransfer.getData('text/plain');
            const card = document.querySelector('.dragging');
            
            if (e.target.classList.contains('drop-zone')) {
                e.target.appendChild(card);
            }
            e.target.classList.remove('active');
        }

        function handleDragOverInsideDropZone(e) {
            e.preventDefault();
            const draggingCard = document.querySelector('.dragging');
            const dropZone = e.currentTarget;
            const afterElement = getDragAfterElement(dropZone, e.clientY);

            if (afterElement) {
                dropZone.insertBefore(draggingCard, afterElement);
            } else {
                dropZone.appendChild(draggingCard);
            }
        }

        function handleDropInsideDropZone(e) {
            e.preventDefault();
            const draggingCard = document.querySelector('.dragging');
            draggingCard.classList.remove('dragging');
        }

        function getDragAfterElement(dropZone, y) {
            const draggableElements = [...dropZone.querySelectorAll('.card:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;

                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Раунд 5: Пароль
        function initRound5() {
            const passwordInput = document.getElementById('passwordInput');
            const rule1 = document.getElementById('rule1');
            const rule2 = document.getElementById('rule2');
            const rule3 = document.getElementById('rule3');

            passwordInput.addEventListener('input', function() {
                const password = this.value;

                // Проверка на длину пароля
                if (password.length >= 8) {
                    rule1.classList.add('valid');
                } else {
                    rule1.classList.remove('valid');
                }

                // Проверка на наличие цифр и букв
                if (/[A-Za-z]/.test(password) && /\d/.test(password)) {
                    rule2.classList.add('valid');
                } else {
                    rule2.classList.remove('valid');
                }

                // Проверка на наличие специальных символов
                if (/[!@#$%^&*]/.test(password)) {
                    rule3.classList.add('valid');
                } else {
                    rule3.classList.remove('valid');
                }
            });
        }

        // Раунд 6: Ребусы
        function initRound6() {
            // Показываем первый ребус
            document.getElementById('rebus1').classList.remove('hidden');
        }

        // Проверка всех раундов
        function checkRound(roundNumber) {
            let correctAnswers = 0; // Количество правильных ответов в текущем раунде

            switch(roundNumber) {
                case 1: 
                    // Считаем количество карточек, перемещенных в правильные зоны
                    const dropZones1 = document.querySelectorAll('#round1 .drop-zone');
                    dropZones1.forEach(zone => {
                        const cardsInZone = zone.querySelectorAll('.card');
                        cardsInZone.forEach(card => {
                            if (card.dataset.correct === zone.dataset.category) {
                                correctAnswers++;
                            }
                        });
                    });
                    break;
                case 2:
                    // Считаем количество правильно сопоставленных пар
                    correctAnswers = matchedPairs.size;
                    break;
                case 3:
                    // Считаем количество правильных ответов
                    correctAnswers = Array.from(selectedAnswers.values()).filter(correct => correct === true).length;
                    break;
                case 4:
                    // Считаем количество правильно собранных предложений
                    const dropZones4 = document.querySelectorAll('#round4 .drop-zone');
                    dropZones4.forEach((zone, index) => {
                        const sentence = sentences[index];
                        const partsInZone = Array.from(zone.children).map(card => card.textContent);
                        if (partsInZone.join(' ') === sentence.parts.join(' ')) {
                            correctAnswers++;
                        }
                    });
                    break;
                case 5:
                    // Считаем количество выполненных требований для пароля
                    const validRules = document.querySelectorAll('#passwordRules .valid').length;
                    correctAnswers = validRules; // 1 балл за каждое выполненное требование
                    break;
                case 6:
                    // Считаем количество правильно разгаданных ребусов
                    for (let i = 1; i <= totalRebuses; i++) {
                        const rebusElement = document.getElementById(`rebus${i}`);
                        const input = rebusElement.querySelector('input');
                        const userAnswer = input.value.trim().toLowerCase();
                        const correctAnswer = input.dataset.answer;

                        if (userAnswer === correctAnswer) {
                            correctAnswers++;
                        }
                    }
                    break;
            }

            score += correctAnswers; // Добавляем правильные ответы к общему счету

            document.getElementById(`round${roundNumber}`).classList.add('hidden');
            currentRound++;
            updateProgress();
            
            if (currentRound <= totalRounds) {
                setTimeout(() => {
                    document.getElementById(`round${currentRound}`).classList.remove('hidden');
                    initNewRound(currentRound);
                }, 300);
            } else {
                showFinalResults();
            }
        }

        // Показ итоговых результатов
        function showFinalResults() {
            // Скрываем все раунды
            document.querySelectorAll('.round').forEach(round => {
                round.classList.add('hidden');
            });

            // Перемещаем блок с результатами в конец контейнера
            const resultsContainer = document.getElementById('results');
            const container = document.querySelector('.container');
            container.appendChild(resultsContainer);

            // Показываем блок с результатами
            resultsContainer.classList.remove('hidden');

            // Анимация начисления баллов для каждого раунда
            const roundResults = [
                { id: 'round1Result', score: getRoundScore(1) },
                { id: 'round2Result', score: getRoundScore(2) },
                { id: 'round3Result', score: getRoundScore(3) },
                { id: 'round4Result', score: getRoundScore(4) },
                { id: 'round5Result', score: getRoundScore(5) },
                { id: 'round6Result', score: getRoundScore(6) },
            ];

            // Функция для анимации начисления баллов
            function animateResults(index) {
                if (index >= roundResults.length) {
                    // После начисления баллов для всех раундов анимируем общий результат
                    const totalScoreElement = document.getElementById('totalScore');
                    totalScoreElement.textContent = score;
                    totalScoreElement.style.opacity = 1;
                    totalScoreElement.style.transform = 'translateY(0)';
                    return;
                }

                const result = roundResults[index];
                const resultElement = document.getElementById(result.id);
                resultElement.textContent = result.score;

                // Анимация появления
                resultElement.style.opacity = 1;
                resultElement.style.transform = 'translateY(0)';

                // Задержка перед следующим раундом
                setTimeout(() => {
                    animateResults(index + 1);
                }, 300); // Задержка 300 мс
            }

            // Запуск анимации
            animateResults(0);
        }

        // Получение результата по раунду
        function getRoundScore(roundNumber) {
            switch(roundNumber) {
                case 1: 
                    return document.querySelectorAll('#round1 .drop-zone .card[data-correct]').length;
                case 2:
                    return matchedPairs.size;
                case 3:
                    return Array.from(selectedAnswers.values()).filter(correct => correct === true).length;
                case 4:
                    // Считаем количество правильно собранных предложений
                    const dropZones4 = document.querySelectorAll('#round4 .drop-zone');
                    let correctSentences = 0;
                    dropZones4.forEach((zone, index) => {
                        const sentence = sentences[index];
                        const partsInZone = Array.from(zone.children).map(card => card.textContent);
                        if (partsInZone.join(' ') === sentence.parts.join(' ')) {
                            correctSentences++;
                        }
                    });
                    return correctSentences;
                case 5:
                    return document.querySelectorAll('#passwordRules .valid').length;
                case 6:
                    let correctRebuses = 0;
                    for (let i = 1; i <= totalRebuses; i++) {
                        const rebusElement = document.getElementById(`rebus${i}`);
                        const input = rebusElement.querySelector('input');
                        const userAnswer = input.value.trim().toLowerCase();
                        const correctAnswer = input.dataset.answer;

                        if (userAnswer === correctAnswer) {
                            correctRebuses++;
                        }
                    }
                    return correctRebuses;
                default:
                    return 0;
            }
        }

        function initNewRound(round) {
            switch(round) {
                case 2: initRound2(); break;
                case 3: initRound3(); break;
                case 4: initRound4(); break;
                case 5: initRound5(); break;
                case 6: initRound6(); break;
            }
        }

        // Функция для перемешивания массива
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Инициализация игры
        document.addEventListener('DOMContentLoaded', () => {
            initRound1();
        });
    </script>
</body>
</html>
